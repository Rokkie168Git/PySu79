{% extends 'base_admin.html' %}
{% block title %}Phone List • Admin{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h4 class="mb-0">Phones</h4>
    <small class="text-muted">All products in your catalog</small>
  </div>
  <a href="{{ url_for('add_phone') }}" class="btn btn-primary"><i class="fas fa-plus mr-1"></i> Add Phone</a>
</div>

<div class="row">
  <!-- phones cards like the screenshot -->
  <div class="col-md-3 mb-3">
    <div class="card">
      <div class="card-body d-flex align-items-center">
        <div class="mr-3"><i class="fas fa-mobile-alt"></i></div>
        <div>
          <div class="text-muted small">Total Products</div>
          <div class="h5 mb-0">{{ phones.total or phones|length }}</div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3 mb-3">
    <div class="card">
      <div class="card-body d-flex align-items-center">
        <div class="mr-3"><i class="fas fa-box-open"></i></div>
        <div>
          <div class="text-muted small">In Stock</div>
          <div class="h5 mb-0">{{ q }}</div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3 mb-3">
    <div class="card">
      <div class="card-body d-flex align-items-center">
        <div class="mr-3"><i class="fas fa-shopping-cart"></i></div>
        <div>
          <div class="text-muted small">Orders (month)</div>
          <div class="h5 mb-0">{{ 466 }}</div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3 mb-3">
    <div class="card">
      <div class="card-body d-flex align-items-center">
        <div class="mr-3"><i class="far fa-star"></i></div>
        <div>
          <div class="text-muted small">Avg. Rating</div>
          <div class="h5 mb-0">{{ 4.6 }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <form class="form-row mb-3" method="GET" action="{{ url_for('phone_list') }}">
      <div class="col-md-4 mb-2">
        <input class="form-control" name="q" value="{{ request.args.get('q','') }}" placeholder="Search name/brand/model…">
      </div>
      <div class="col-md-3 mb-2">
        <select class="form-control" name="available">
          <option value="">Availability</option>
          <option value="in_stock"     {{ 'selected' if request.args.get('available')=='in_stock' }}>In stock</option>
          <option value="preorder"     {{ 'selected' if request.args.get('available')=='preorder' }}>Pre-order</option>
          <option value="out_of_stock" {{ 'selected' if request.args.get('available')=='out_of_stock' }}>Out of stock</option>
        </select>
      </div>
      <div class="col-md-3 mb-2">
        <select class="form-control" name="brand">
          <option value="">Brand</option>
          {% for b in brands or [] %}<option value="{{ b }}" {{ 'selected' if request.args.get('brand')==b }}>{{ b }}</option>{% endfor %}
        </select>
      </div>
      <div class="col-md-2 mb-2 text-right">
        <button class="btn btn-outline-secondary">Filter</button>
      </div>
    </form>

    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="thead-light">
          <tr>
            <th>ID</th>
            <th>Image</th>
            <th>Name</th>
            <th>Brand</th>
            <th>Model</th>
            <th>Price</th>
            <th>Qty</th>
            <th>Available</th>
            <th class="text-right" style="width:210px">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for p in phones %}

          <tr>
            <td>{{ p.id }}</td>
            <td><a href="/product/{{ p.id }}"><img src="/static/img/{{p.main_image}}" class="img-thumbnail" style="width:48px;height:48px;object-fit:contain"></a></td>
            <td class="font-weight-500">{{ p.name }}</td>
            <td>{{ p.brand }}</td>
            <td>{{ p.model }}</td>
            <td>${{ '%.2f'|format(p.price) }}</td>
            <td>{{ p.quantity }}</td>
            <td>
              {% if p.available=='in_stock' %}<span class="badge badge-success">In stock</span>
              {% elif p.available=='preorder' %}<span class="badge badge-info">Pre-order</span>
              {% else %}<span class="badge badge-secondary">Out of stock</span>{% endif %}
            <td class="text-right align-middle">
  <div class="btn-group" role="group">
    <a href="{{ url_for('phone_update', phone_id=p.id) }}" class="btn btn-sm btn-primary">
      <i class="far fa-edit"></i>
    </a>

    <form action="{{ url_for('phone_delete', phone_id=p.id) }}"
      method="POST"
      class="js-delete-form d-inline mb-0">
  {# if you use CSRF #}
  <button type="submit" class="btn btn-sm btn-danger">
    <i class="far fa-trash-alt"></i>
  </button>
</form>
  </div>
</td>

          {% else %}
          <tr><td colspan="9" class="text-center text-muted">No phones found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% if pagination %}
  <div class="card-footer d-flex justify-content-between align-items-center">
    <div class="small text-muted">Showing {{ pagination.start_index }}–{{ pagination.end_index }} of {{ pagination.total }}</div>
    <nav>
      <ul class="pagination mb-0">
        <li class="page-item {{ 'disabled' if not pagination.prev }}"><a class="page-link" href="{{ url_for('phone_list', page=pagination.prev, **request.args.to_dict()) if pagination.prev }}">Prev</a></li>
        {% for pnum in pagination.pages %}
        <li class="page-item {{ 'active' if pnum==pagination.page }}"><a class="page-link" href="{{ url_for('phone_list', page=pnum, **request.args.to_dict()) }}">{{ pnum }}</a></li>
        {% endfor %}
        <li class="page-item {{ 'disabled' if not pagination.next }}"><a class="page-link" href="{{ url_for('phone_list', page=pagination.next, **request.args.to_dict()) if pagination.next }}">Next</a></li>
      </ul>
    </nav>
  </div>
  {% endif %}
</div>
{% endblock %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener('click', function (e) {
  const btn = e.target.closest('.js-delete-form button[type="submit"]');
  if (!btn) return;

  const form = btn.closest('form');
  e.preventDefault(); // stop immediate submit

  Swal.fire({
    title: 'Are you sure?',
    text: 'Do you want to delete this phone?',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Yes, delete it',
    cancelButtonText: 'No, cancel',
    confirmButtonColor: '#28a745',
    cancelButtonColor: '#d33',
    reverseButtons: true
  }).then((result) => {
    if (result.isConfirmed) {
      // prevent accidental double submits
      btn.disabled = true;
      form.submit();
    }
  });
});
</script>