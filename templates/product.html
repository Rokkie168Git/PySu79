{% extends 'master.html' %}
{% block container %}
<div class="container mt-5">
  {% for item in phone %}
  <div class="row align-items-start mb-5" style="display:flex;">
    <!-- Images (left) -->
    <div class="col-md-6">
  <!-- Main image carousel -->
  <div id="phoneCarousel-{{ loop.index }}" class="carousel slide mb-3" data-ride="carousel" data-interval="false">
    <div class="carousel-inner text-center">
      <!-- MAIN -->
      <div class="carousel-item active">
        <img
          src="{{ item.main_image }}"
          class="d-block w-100"
          alt="{{ item.brand }} {{ item.name }}"
          style="height:420px; object-fit:contain; background:#f8f9fa;">
      </div>
      <!-- SIDE -->
      <div class="carousel-item">
        <img
          src="{{ item.side_image }}"
          class="d-block w-100"
          alt="Side image"
          style="height:420px; object-fit:contain; background:#f8f9fa;">
      </div>
      <!-- SUB -->
      <div class="carousel-item">
        <img
          src="{{ item.sub_image }}"
          class="d-block w-100"
          alt="Sub image"
          style="height:420px; object-fit:contain; background:#f8f9fa;">
      </div>
    </div>

    <!-- Prev/Next controls (optional) -->
    <a class="carousel-control-prev" href="#phoneCarousel-{{ loop.index }}" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#phoneCarousel-{{ loop.index }}" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>

  <!-- Thumbnails as indicators (click to change main image) -->
  <div class="row no-gutters justify-content-center">
    <div class="col-4 px-1">
      <a href="#phoneCarousel-{{ loop.index }}" data-target="#phoneCarousel-{{ loop.index }}" data-slide-to="0" class="d-block border rounded">
        <img src="{{ item.main_image }}" class="img-fluid" alt="Main"
             style="height:120px; width:100%; object-fit:contain; background:#f8f9fa;">
      </a>
    </div>
    <div class="col-4 px-1">
      <a href="#phoneCarousel-{{ loop.index }}" data-target="#phoneCarousel-{{ loop.index }}" data-slide-to="1" class="d-block border rounded">
        <img src="{{ item.side_image }}" class="img-fluid" alt="Side"
             style="height:120px; width:100%; object-fit:contain; background:#f8f9fa;">
      </a>
    </div>
    <div class="col-4 px-1">
      <a href="#phoneCarousel-{{ loop.index }}" data-target="#phoneCarousel-{{ loop.index }}" data-slide-to="2" class="d-block border rounded">
        <img src="{{ item.sub_image }}" class="img-fluid" alt="Sub"
             style="height:120px; width:100%; object-fit:contain; background:#f8f9fa;">
      </a>
    </div>
  </div>
</div>

    <!-- Info (right) -->
    <div class="col-md-6">
      <h4 class="mb-1">{{ item.brand }} {{ item.name }}</h4>
      <div class="mb-2">
        <span class="badge badge-secondary">Model: {{ item.model }}</span>
        <span class="badge badge-info ml-1">{{ item.type|title }}</span>
        <span class="badge badge-light ml-1">Color: {{ item.color }}</span>
      </div>

      <div class="price-tag mt-2 mb-3" style="font-size:1.4rem; font-weight:700;">
        ${{ '%.2f'|format(item.price) }}
      </div>

      <div class="mb-3">
        {% if item.available == 'in_stock' %}
          <span class="badge badge-success">In stock</span>
        {% elif item.available == 'preorder' %}
          <span class="badge badge-warning">Pre-order</span>
        {% else %}
          <span class="badge badge-danger">Out of stock</span>
        {% endif %}
        <small class="text-muted ml-2">Qty: {{ item.quantity }}</small>
        <small class="text-muted ml-2">Warranty: {{ item.warranty_mo }} mo</small>
      </div>

      {% if item.highlights %}
      <h6>Highlights</h6>
      <ul>
        {% for h in item.highlights.replace('\r','').split('\n') if h.strip() %}
          <li>{{ h }}</li>
        {% endfor %}
      </ul>
      {% endif %}

      <h6 class="mt-3">Specifications</h6>
      <ul class="mb-3">
        <li><b>OS:</b> {{ item.os }}</li>
        <li><b>CPU:</b> {{ item.cpu }}</li>
        <li><b>RAM:</b> {{ item.ram_gb }} GB</li>
        <li><b>Storage:</b> {{ item.storage_gb }} GB</li>
        <li><b>Display:</b> {{ item.display }}</li>
        <li><b>Cameras:</b> {{ item.cameras }}</li>
        <li><b>Battery:</b> {{ item.battery_mah }} mAh</li>
        <li><b>Network:</b> {{ item.network }}</li>
      </ul>

      {% if item.description %}
      <h6>Description</h6>
      <p style="max-width:480px; white-space:pre-line;">{{ item.description }}</p>
      {% endif %}

      <form class="form-inline mb-3">
        <label for="quantity" class="mr-2">Quantity:</label>
        <input type="number" class="form-control mr-3" id="quantity" name="quantity" value="1" min="1">
        <button @click="add({{ item }})" class="add-cart-btn btn btn-primary" id="addcart" type="button">Add to Cart</button>
      </form>
    </div>
  </div>
  {% endfor %}
</div>

<!-- JS to switch main image -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.thumb-image').forEach(function(thumb) {
      thumb.addEventListener('click', function() {
        const targetSelector = this.getAttribute('data-target');
        const mainImg = document.querySelector(targetSelector);
        if (mainImg) {
          mainImg.src = this.src;
        }
      });
    });
  });
</script>
{% endblock %}
