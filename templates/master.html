<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RONGSTORE</title>
    <!-- Bootstrap CSS v4.6 -->
   {% include 'style.html' %}


</head>
<body>
<div id="app">

    <!-- Navbar -->

<nav class="navbar navbar-expand-lg navbar-light bg-light px-3 py-2 fixed-top">
  <div class="container-fluid">

    <!-- Brand -->
    <a class="navbar-brand" href="/">RONGSTORE</a>

    <!-- Burger Menu for small screens -->
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainNavbar"
      aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="mainNavbar">

      <!-- Left-side nav links -->
      <ul class="navbar-nav mr-auto" >
        <li class="nav-item"><a class="nav-link" href="/">Catalog</a></li>
        <li class="nav-item"><a class="nav-link" href="/brand/Samsung">SAMSUNG</a></li>
        <li class="nav-item"><a class="nav-link" href="/brand/Apple">Apple</a></li>
        <li class="nav-item"><a class="nav-link" href="/brand/Oppo">Oppo</a></li>
        <li class="nav-item"><a class="nav-link" href="/brand/Xiaomi">Xiaomi</a></li>
        <li class="nav-item"><a class="nav-link" href="/brand/Vivo">Vivo</a></li>
          <li class="nav-item"><a class="nav-link" href="/support">Support</a></li>
          <li class="nav-item"><a class="nav-link" href="/login_admin">Admin</a></li>
      </ul>

      <!-- Right-side search + cart (always shown) -->
     <div class="d-flex align-items-center ml-auto" style="gap: 10px; max-width: 700px;">
{#  <a href="/register" class="mr-2">#}
{#    <i class="fa-sharp-duotone fa-solid fa-user-plus fa-bounce"></i>#}
{#  </a>#}
  <form id="searchForm" method="POST" action="{{ url_for('search') }}">
    <div class="input-group">
        <input id="searchInput" class="form-control" type="search" name="search" placeholder="name products">
        <button class="btn btn-primary" type="submit">
            <i class="fa-solid fa-magnifying-glass"></i>
        </button>
    </div>
</form>
  <a class="btn btn-outline-primary" href="/pagecart" style="min-width: 110px;">
    Cart <span id="cart">([[cart_list.length]])</span>
  </a>
</div>



    </div>
  </div>
</nav>

    <!-- Main Content - Split Layout & Full-Width Products -->
    <div class="container">
        {% block slide %}
        	
        {% endblock %}

        <!-- Section for "More Products You Might Like" - Full Width -->
        {% block container %}
        	
        {% endblock %}

    </div>





    <!-- Bootstrap JS and dependencies -->
</div>

<footer class="site-footer mt-auto text-light">
  <!-- Newsletter -->
  <div class="footer-newsletter bg-primary">
    <div class="container py-4">
      <div class="row align-items-center g-3">
        <div class="col-lg-5">
          <h5 class="mb-1 fw-bold">Join our newsletter</h5>
          <div class="small text-white-50">Get updates on deals, new arrivals, and more.</div>
        </div>
        <div class="col-lg-7">
          <form class="row g-2" onsubmit="event.preventDefault(); alert('Thanks for subscribing!');">
            <div class="col-md-8">
              <input type="email" class="form-control form-control-lg" placeholder="Enter your email" required>
            </div>
            <div class="col-md-4 d-grid">
              <button class="btn btn-dark btn-lg" type="submit">Subscribe</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Main footer -->
  <div class="bg-dark">
    <div class="container py-5">
<div class="row g-4">
  <!-- Brand / About -->
  <div class="col-md-3">
    <a class="navbar-brand text-light fs-4 fw-bold" href="{{ url_for('catalog') }}">SU7-Ecommerce</a>
    <p class="text-white-50 mt-2">
      Quality picks, fast shipping, and easy returns. Build your setup, your way.
    </p>
    <div class="d-flex gap-3 mt-3 fs-4">
      <a class="text-light opacity-75" href="#"><i class="bi bi-facebook"></i></a>
      <a class="text-light opacity-75" href="#"><i class="bi bi-instagram"></i></a>
      <a class="text-light opacity-75" href="#"><i class="bi bi-twitter-x"></i></a>
      <a class="text-light opacity-75" href="#"><i class="bi bi-youtube"></i></a>
    </div>
  </div>

  <!-- Customer Service -->
  <div class="col-md-3">
    <h6 class="text-uppercase small text-white-50">Customer Service</h6>
    <ul class="list-unstyled mt-3 footer-links">
      <li><a href="#">Help Center</a></li>
      <li><a href="#">Shipping & Delivery</a></li>
      <li><a href="#">Returns & Refunds</a></li>
      <li><a href="#">Track Order</a></li>
    </ul>
  </div>

  <!-- Midterm -->
  <div class="col-md-3">
    <h6 class="text-uppercase small text-white-50">Midterm SU7.9</h6>
    <ul class="list-unstyled mt-3 footer-links">
      <li><span class="badge bg-warning text-dark">Lecturer</span> Heng Monorom</li>
      <li>Group SU7.9</li>
      <li>Subject: E-commerce</li>
    </ul>
  </div>

  <!-- Team -->
  <div class="col-md-3">
    <h6 class="text-uppercase small text-white-50">My Team</h6>
    <ul class="list-unstyled mt-3 footer-links">
      <li><span class="badge bg-light text-dark me-2">Leader</span> THY Bunrong</li>
      <li>Vuthea Sovichet</li>
      <li>PHA Phanith</li>
      <li>Kong Makara</li>
        <li>Sreang mengsruy</li>

    </ul>
  </div>
</div>

      <hr class="footer-hr my-4">

      <div class="d-flex flex-column flex-md-row align-items-center justify-content-between">
        <div class="small text-white-50 mb-3 mb-md-0">
          © {{ current_year }} SU7-Ecommerce • All rights reserved.
        </div>
        <div class="d-flex align-items-center gap-3 text-white-50">
          <i class="bi bi-shield-lock"></i> Secure checkout
          <span class="vr opacity-25"></span>
          <i class="bi bi-credit-card-2-front"></i> Visa
          <i class="bi bi-credit-card"></i> MasterCard
          <i class="bi bi-paypal"></i> PayPal
        </div>
      </div>
    </div>
  </div>
</footer>

{% include 'js.html' %}

  <script>
const { createApp } = Vue;
createApp({
  delimiters: ['[[', ']]'],
  data() {
    // Load from localStorage and ensure all items have qty
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    cart.forEach(item => {
      if (!item.qty || isNaN(item.qty)) item.qty = 1;
      // You can add other default fields here if needed
    });
    return {
      cart_list: cart,
      total: 0,
      mode: 'login', // or 'register'
      loginForm: { username: '', password: '' },
      registerForm: { username: '', password: '', email: '' },
      message: '',
      fullName: '',
      address: '',
      email: '',
      phone: '',
      amount: {
        us: 'Login'
      }
    }
  },
  mounted() {
    // Extra protection: fix old items if any without qty
    this.cart_list.forEach(item => {
      if (!item.qty || isNaN(item.qty)) item.qty = 1;
    });
    this.updateCartStorage();
  },
  methods: {
    // Add to cart (avoid duplicates)
    add(item) {
      let found = this.cart_list.find(i => i.id === item.id);
      if (found) {
        found.qty += 1;
      } else {
        // Always set qty = 1 on new items
        this.cart_list.push({ ...item, qty: 1 });
      }
      this.updateCartStorage();
      Swal.fire({
  position: "top-end",
  icon: "success",
  title: "Product Has been Add to Cart",
  showConfirmButton: false,
  timer: 1500
});
    },

    // Remove item
    RemoveCart(index) {
      const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
          confirmButton: "btn btn-success",
          cancelButton: "btn btn-danger"
        },
        buttonsStyling: false
      });
      swalWithBootstrapButtons.fire({
        title: "Are you sure 🥺 ?",
        text: "You won't be able to revert this!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Yes, Remove it!",
        cancelButtonText: "No, cancel!",
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          this.cart_list.splice(index, 1);
          this.updateCartStorage();
          swalWithBootstrapButtons.fire({
            title: "Removed!",
            text: "Your Cart has been Removed.",
            icon: "success"
          });
        } else if (result.dismiss === Swal.DismissReason.cancel) {
          swalWithBootstrapButtons.fire({
            title: "Cancelled",
            text: "Your Cart here :)",
            icon: "error"
          });
        }
      });
    },

    // Quantity + and -
    increaseQty(index) {
      this.cart_list[index].qty++;
      this.updateCartStorage();
    },
    decreaseQty(index) {
      if (this.cart_list[index].qty > 1) {
        this.cart_list[index].qty--;
        this.updateCartStorage();
      }
      // Optionally, remove if qty reaches 0:
      // else {
      //   this.cart_list.splice(index, 1);
      //   this.updateCartStorage();
      // }
    },

    // Sync to localStorage
    updateCartStorage() {
      localStorage.setItem('cart', JSON.stringify(this.cart_list));
    },

    // Total calculation uses qty!
    totalPrice() {
      return this.cart_list.reduce(
        (sum, item) => sum + Number(item.price) * (item.qty || 1),
        0
      );
    },
    tax() {
      return this.totalPrice() * 15 / 100;
    },
    Total() {
      return this.totalPrice() + this.tax();
    },

    // Login/Register logic (unchanged)
    login() {
      if (this.loginForm.username && this.loginForm.password) {
        let users = JSON.parse(localStorage.getItem('User')) || [];
        const found = users.find(u =>
          u.username === this.loginForm.username &&
          u.password === this.loginForm.password
        );
        if (found) {
          this.message = `Welcome, ${found.username}! 🎉`;
          setTimeout(() => { window.location.href = '/'; }, this.us = found.username);
        } else {
          this.message = 'Invalid username or password.';
        }
      } else {
        this.message = 'Please enter your username and password.';
      }
    },
    register() {
      if (this.registerForm.username && this.registerForm.password && this.registerForm.email) {
        const data = {
          username: this.registerForm.username,
          password: this.registerForm.password,
          email: this.registerForm.email
        };
        let users = JSON.parse(localStorage.getItem('User')) || [];
        if (users.find(u => u.username === data.username)) {
          this.message = 'Username already exists.';
          return;
        }
        users.push(data);
        localStorage.setItem('User', JSON.stringify(users));
        this.message = `Thanks for registering, ${data.username}!`;
        setTimeout(() => { this.mode = 'login'; this.message = ''; }, 1300);
      } else {
        this.message = 'Please fill in all fields.';
      }
    },

    // Order submission (unchanged, but now qty always exists)
    submitOrder(event) {
      const form = event.target.closest('form');
      if (!form.checkValidity()) {
        form.classList.add('was-validated');
        return;
      }
      form.classList.remove('was-validated');
      const allowedDomains = [
        "gmail.com", "yahoo.com", "hotmail.com", "outlook.com", "icloud.com", "live.com", "protonmail.com", "aol.com"
      ];
      const email = this.email.trim();
      if (!email.includes('@')) {
        alert('Please enter a valid email address.');
        return;
      }
      const emailDomain = email.split('@')[1].toLowerCase();
      if (!allowedDomains.includes(emailDomain)) {
        alert('Please enter a real email address (Gmail, Yahoo, Outlook, etc.)');
        return;
      }
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      let cartSummary = cart.map(item => ({
        title: item.name,
          brand:item.brand,
        price: item.price,
          image:item.main_image,
        qty: item.qty || 1
      }));
      let total = cart.reduce((sum, item) => sum + Number(item.price) * (item.qty || 1), 0);
      fetch('api/send-cart-order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          fullName: this.fullName,
          address: this.address,
          email: this.email,
          phone: this.phone,
          cart: cartSummary,
          total: total
        })
      })
        .then(res => res.json())
        .then(data => {
          Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: '💕Your order was successful 😍.',
            showConfirmButton: false,
            timer: 1500
          }).then(() => {
            localStorage.removeItem('cart');
            window.location.href = '/';
          });
        })
        .catch(e => alert('Error: ' + e));
    }
  }
}).mount('#app');
</script>


</body>

</html>
